(()=>{"use strict";function t(t,e){document.getElementById("coord-x").textContent=`Re: ${t.toFixed(15)}`,document.getElementById("coord-y").textContent=`Im: ${e.toFixed(15)}`}const e=[];function i(t,i){const s=Number(t.min),h=Number(t.max),a=Number(t.value);e.push(t);const n=()=>{let e=Number(t.value);""===t.value&&(e=a,t.value=e.toString()),e<s?(e=s,t.value=e.toString()):e>h&&(e=h,t.value=e.toString()),e>=s&&e<=h&&i(e)};t.addEventListener("input",n),t.addEventListener("change",n)}class s{cache=[];x=0;lastX=0;y=0;lastY=0;delta=0;dragStartHandler;dragUpdateHandler;dragStopHandler;zoomStartHandler;zoomUpdateHandler;zoomStopHandler;constructor(t){t.addEventListener("pointerdown",this.handlePointerDown.bind(this)),t.addEventListener("pointermove",this.handlePointerMove.bind(this)),t.addEventListener("pointerup",this.handlePointerUp.bind(this)),t.addEventListener("pointercancel",this.handlePointerUp.bind(this)),t.addEventListener("pointerout",this.handlePointerUp.bind(this)),t.addEventListener("pointerleave",this.handlePointerUp.bind(this)),t.addEventListener("gesturestart",this.handleGestureStart.bind(this)),t.addEventListener("gesturechange",this.handleGestureChange.bind(this)),t.addEventListener("gestureend",this.handleGestureEnd.bind(this))}on(t,e){switch(t){case"dragstart":this.dragStartHandler=e;break;case"dragupdate":this.dragUpdateHandler=e;break;case"dragstop":this.dragStopHandler=e;break;case"zoomstart":this.zoomStartHandler=e;break;case"zoomupdate":this.zoomUpdateHandler=e;break;case"zoomstop":this.zoomStopHandler=e}}handlePointerDown(t){switch(this.cache.push(t),this.cache.length){case 1:this.startDrag();break;case 2:this.stopDrag(),this.startZoom();break;case 3:this.stopZoom()}}handlePointerMove(t){for(let e=0;e<this.cache.length;++e)if(this.cache[e].pointerId==t.pointerId){this.cache[e]=t;break}switch(this.cache.length){case 1:this.updateDrag();break;case 2:this.updateZoom()}}handlePointerUp(t){let e=!1;switch(this.cache.length){case 1:this.stopDrag();break;case 2:this.stopZoom(),e=!0;break;case 3:this.startZoom()}for(let e=0;e<this.cache.length;++e)if(this.cache[e].pointerId==t.pointerId){this.cache.splice(e,1);break}e&&this.startDrag()}handleGestureStart(t){t.preventDefault(),this.x=t.clientX,this.y=t.clientY,this.dragStartHandler&&this.dragStartHandler({x:0,y:0}),this.zoomStartHandler&&this.zoomStartHandler({x:this.x,y:this.y,scale:1}),this.lastX=t.clientX,this.lastY=t.clientY}handleGestureChange(t){t.preventDefault(),this.lastX=t.clientX,this.lastY=t.clientY,!this.dragUpdateHandler||this.lastX==t.clientX&&this.lastY==t.clientY||this.dragUpdateHandler({x:t.clientX-this.lastX,y:t.clientY-this.lastY}),this.zoomUpdateHandler&&this.zoomUpdateHandler({x:t.clientX,y:t.clientY,scale:t.scale}),this.lastX=t.clientX,this.lastY=t.clientY}handleGestureEnd(t){t.preventDefault(),this.dragStopHandler&&this.dragStopHandler({x:t.clientX-this.lastX,y:t.clientY-this.lastY}),this.zoomStopHandler&&this.zoomStopHandler({x:t.clientX,y:t.clientY,scale:t.scale})}startDrag(){this.x=this.cache[0].clientX,this.y=this.cache[0].clientY,null!=this.dragStartHandler&&this.dragStartHandler({x:this.cache[0].clientX-this.x,y:this.cache[0].clientY-this.y})}updateDrag(){null!=this.dragUpdateHandler&&this.dragUpdateHandler({x:this.cache[0].clientX-this.x,y:this.cache[0].clientY-this.y})}stopDrag(){null!=this.dragStopHandler&&this.dragStopHandler({x:this.cache[0].clientX-this.x,y:this.cache[0].clientY-this.y})}startZoom(){const t=this.cache[0].clientX-this.cache[1].clientX,e=this.cache[0].clientY-this.cache[1].clientY;if(this.delta=Math.sqrt(t*t+e*e),null!=this.zoomStartHandler){const t=(this.cache[0].clientX+this.cache[1].clientX)/2,e=(this.cache[0].clientY+this.cache[1].clientY)/2;this.zoomStartHandler({x:t,y:e,scale:1})}}updateZoom(){if(null!=this.zoomUpdateHandler){const t=(this.cache[0].clientX+this.cache[1].clientX)/2,e=(this.cache[0].clientY+this.cache[1].clientY)/2,i=this.cache[0].clientX-this.cache[1].clientX,s=this.cache[0].clientY-this.cache[1].clientY,h=Math.sqrt(i*i+s*s);this.zoomUpdateHandler({x:t,y:e,scale:h/this.delta})}}stopZoom(){if(null!=this.zoomStopHandler){const t=(this.cache[0].clientX+this.cache[1].clientX)/2,e=(this.cache[0].clientY+this.cache[1].clientY)/2,i=this.cache[0].clientX-this.cache[1].clientX,s=this.cache[0].clientY-this.cache[1].clientY,h=Math.sqrt(i*i+s*s);this.zoomStopHandler({x:t,y:e,scale:h/this.delta})}}}class h{rect=new DOMRect(-1,-1,2,2);canvas;gl;program;uniforms;cachedConfig;constructor(t,e,i){this.canvas=t,this.gl=t.getContext("webgl"),this.program=function(t,e,i){const s=t.createProgram();if(null==s)throw new Error("Failed to create a GL program");const h=t.createShader(t.VERTEX_SHADER);if(!h)throw t.deleteProgram(s),new Error("Failed to create vertex shader!");const a=t.createShader(t.FRAGMENT_SHADER);if(!a)throw t.deleteProgram(s),t.deleteShader(h),new Error("Failed to create fragment shader!");if(t.shaderSource(h,e),t.shaderSource(a,i),t.attachShader(s,h),t.attachShader(s,a),t.compileShader(h),t.compileShader(a),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){let e="Failed to link shader program:";const i=t.getProgramInfoLog(s);i&&(e+="\n"+i);const n=t.getShaderInfoLog(h);n&&(e+="Vertex shader log:\n"+n);const r=t.getShaderInfoLog(a);throw r&&(e+="Fragment shader log:\n"+r),t.deleteShader(h),t.deleteShader(a),t.deleteProgram(s),new Error(e)}return t.deleteShader(h),t.deleteShader(a),s}(this.gl,e,i),function(t,e,i){let s;s=i;const h=t.createBuffer();if(null==h)throw new Error("Failed to create a buffer.");const a=new Float32Array([-1,-1,-1,1,1,-1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s)}(this.gl,this.program,"aPos");const s=this.canvas.width/this.canvas.height;this.rect.width*=s,this.rect.x*=s,this.gl.useProgram(this.program),this.uniforms={uPos:this.gl.getUniformLocation(this.program,"uPos"),uDims:this.gl.getUniformLocation(this.program,"uDims"),uLim:this.gl.getUniformLocation(this.program,"uLim"),uEscapeD:this.gl.getUniformLocation(this.program,"uEscapeD"),uInsideColor:this.gl.getUniformLocation(this.program,"uInsideColor")}}resize(t,e){const i=t/e;this.rect.height*=e/this.canvas.height,this.rect.width=this.rect.height*i,this.canvas.width=t,this.canvas.height=e,this.gl.viewport(0,0,t,e),this.cachedConfig&&this.draw(this.cachedConfig)}pan(t,e){this.rect.x-=t/this.canvas.width*this.rect.width,this.rect.y+=e/this.canvas.height*this.rect.height,this.cachedConfig&&this.draw(this.cachedConfig)}zoom(t,e,i){this.rect.x+=t/this.canvas.width*(this.rect.width-this.rect.width*i),this.rect.y+=(1-e/this.canvas.height)*(this.rect.height-this.rect.height*i),this.rect.width*=i,this.rect.height*=i,this.cachedConfig&&this.draw(this.cachedConfig)}draw(t){this.gl.useProgram(this.program),this.gl.uniform2f(this.uniforms.uPos,this.rect.x+.5*this.rect.width,this.rect.y+.5*this.rect.height),this.gl.uniform2f(this.uniforms.uDims,.5*this.rect.width,.5*this.rect.height),this.gl.uniform1i(this.uniforms.uLim,t.limit),this.gl.uniform1f(this.uniforms.uEscapeD,2*t.escapeR),this.gl.uniform4f(this.uniforms.uInsideColor,0,0,0,1),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.cachedConfig=t}}class a{static DEFAULT_WIDTH=400;menu;button;width=a.DEFAULT_WIDTH;maxWidth;constructor(t,e,i){this.menu=t,this.button=e,null!=i&&(this.width=i.width||a.DEFAULT_WIDTH,this.maxWidth=i.max_rel_width),this.button.addEventListener("click",this.toggle.bind(this)),this.close()}open(){null!=this.maxWidth&&window.innerWidth*this.maxWidth<this.width?this.menu.style.width="100%":this.menu.style.width=`${this.width}px`}close(){this.menu.style.width="0px"}toggle(){"0px"===this.menu.style.width?this.open():this.close()}}const n=document.getElementById("canvas");let r,c=null,o=0,d=0,l=0;function m(){c&&r&&c.draw(r)}function g(t){o==t.x&&d==t.y||!c||c.pan(t.x-o,t.y-d),o=t.x,d=t.y}function u(t){g(t),t.scale!=l&&c&&c.zoom(t.x,t.y,l/t.scale),l=t.scale}(()=>{n.width=window.innerWidth,n.height=window.innerHeight,function(t,e){return Promise.all([fetch("shaders/identity.vs",{mode:"same-origin"}).then((t=>t.text())),fetch("shaders/mandel.fs",{mode:"same-origin"}).then((t=>t.text()))]).then((([e,i])=>new h(t,e,i)))}(n).then((t=>{c=t,requestAnimationFrame(m)}));const t=new s(n);t.on("dragstart",(t=>{o=t.x,d=t.y})),t.on("dragupdate",g),t.on("dragstop",g),t.on("zoomstart",(t=>{o=t.x,d=t.y,l=t.scale})),t.on("zoomupdate",u),t.on("zoomstop",u),n.addEventListener("wheel",(t=>{c?.zoom(t.clientX,t.clientY,1+.001*t.deltaY),t.preventDefault()})),window.addEventListener("resize",(()=>c?.resize(window.innerWidth,window.innerHeight)))})(),window.onload=()=>{new a(document.getElementById("side-menu"),document.getElementById("toggle-menu"),{width:400,max_rel_width:.6});{r={limit:0,escapeR:0};const t=document.getElementById("limit");r.limit=Number(t.value),i(t,(t=>{r.limit=t,requestAnimationFrame(m)}));const e=document.getElementById("escaper");r.escapeR=Number(e.value),i(e,(t=>{r.escapeR=t,requestAnimationFrame(m)}))}{const t=document.getElementById("toggle_fs");document.fullscreenEnabled?t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}:t.remove()}document.getElementById("redraw").onclick=m,document.getElementById("reset").onclick=()=>{if(e.forEach((t=>{t.value="";const e=document.createEvent("Event");e.initEvent("input"),t.dispatchEvent(e)})),c){const e=n.width/n.height;c.rect.y=-1,c.rect.height=2,c.rect.x=-e,c.rect.width=2*e,t(c.rect.x+.5*c.rect.width,c.rect.y+.5*c.rect.height)}},n.addEventListener("mousemove",(e=>{c&&t(c.rect.x+e.clientX/n.width*c.rect.width,c.rect.y+e.clientY/n.height*c.rect.height)})),n.addEventListener("mouseleave",(()=>{c&&t(c.rect.x+.5*c.rect.width,c.rect.y+.5*c.rect.height)})),c&&t(c.rect.x+.5*c.rect.width,c.rect.y+.5*c.rect.height)}})();