(()=>{"use strict";var t={447:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ProceduralImageView=void 0,e.ProceduralImageView=class{constructor(t,e,i,h=64,s=64){if(this.canvas=t,this.context=t.getContext("2d"),this.chunkWidth=h,this.chunkHeight=s,void 0===e){let t=this.canvas.width/this.canvas.height;this.viewport=new DOMRect(-.8-1.1*t,-1.1,2.2*t,2.2)}else this.viewport=e;i=i||window.navigator.hardwareConcurrency,this.workers=[],this.nextWorkerIndex=0,this.limit=30,this.updateTimer=0,this.offsetX=0,this.offsetY=0;for(var a=0;a<i;++a)this.workers.push(new Worker("./scripts/draw_worker.js")),this.workers[a].onmessage=t=>{t.data.limit==this.limit&&t.data.viewport.width==this.viewport.width&&t.data.viewport.height==this.viewport.height&&this.context.putImageData(t.data.image,t.data.pixelX+this.offsetX-t.data.offsetX,t.data.pixelY+this.offsetY-t.data.offsetY)}}update(t,e){e=e||new DOMRect(0,0,this.canvas.width,this.canvas.height),this.limit=t;let i=e.width/this.chunkWidth,h=e.height/this.chunkHeight;null!=this.clearStyle&&(this.context.fillStyle=this.clearStyle);for(var s={image:void 0,rect:new DOMRect,limit:this.limit,viewport:this.viewport,offsetX:this.offsetX,offsetY:this.offsetY,pixelX:0,pixelY:0},a=0;a<h;++a){var n=Math.min(e.height-a*this.chunkHeight,this.chunkHeight);s.pixelY=e.y+a*this.chunkHeight,s.rect.y=this.viewport.y+(e.y+a*this.chunkHeight)/this.canvas.height*this.viewport.height,s.rect.height=n/this.canvas.height*this.viewport.height;for(var o=0;o<i;++o){var r=Math.min(e.width-o*this.chunkWidth,this.chunkWidth);s.pixelX=e.x+o*this.chunkWidth,s.rect.x=this.viewport.x+(e.x+o*this.chunkWidth)/this.canvas.width*this.viewport.width,s.rect.width=r/this.canvas.width*this.viewport.width,null!=s.image&&s.image.width==r&&s.image.height==n||(s.image=this.context.createImageData(r,n)),this.workers[this.nextWorkerIndex].postMessage(s),this.nextWorkerIndex=(this.nextWorkerIndex+1)%this.workers.length}}}reset(t){if(this.canvas.width>=this.canvas.height){let t=this.canvas.width/this.canvas.height;this.viewport=new DOMRect(-t,-1,2*t,2)}else{let t=this.canvas.height/this.canvas.height;this.viewport=new DOMRect(-1,-t,2,2*t)}this.update(t)}pan(t,e){let i=t>=0?t:this.canvas.width+t,h=e>=0?e:this.canvas.height+e,s=[];if(this.viewport.x-=t/this.canvas.width*this.viewport.width,this.viewport.y-=e/this.canvas.height*this.viewport.height,this.offsetX+=t,this.offsetY+=e,s=[new DOMRect(0,0,i,h),new DOMRect(i,0,this.canvas.width-i,h),new DOMRect(0,h,i,this.canvas.height-h),new DOMRect(i,h,this.canvas.width-i,this.canvas.height-h)],t<0&&e<0){let i=this.context.getImageData(-t,-e,s[0].width,s[0].height);this.context.putImageData(i,0,0),s.splice(0,1)}else if(t>=0&&e<0){let i=this.context.getImageData(0,-e,s[1].width,s[1].height);this.context.putImageData(i,t,0),s.splice(1,1)}else if(t<0&&e>=0){let i=this.context.getImageData(-t,0,s[2].width,s[2].height);this.context.putImageData(i,0,e),s.splice(2,1)}else if(t>=0&&e>=0){let i=this.context.getImageData(0,0,s[3].width,s[3].height);this.context.putImageData(i,t,e),s.splice(3,1)}s.forEach((t=>this.update(this.limit,t)))}zoom(t,e,i,h=0){let s=t/this.canvas.width,a=e/this.canvas.height,n=this.viewport.x+this.viewport.width*s,o=this.viewport.y+this.viewport.height*a;if(this.viewport.width*=i,this.viewport.height*=i,this.viewport.x=n-this.viewport.width*s,this.viewport.y=o-this.viewport.height*a,i>1){let t=1/i;this.context.drawImage(this.canvas,this.canvas.width*s-this.canvas.width*s*t,this.canvas.height*a-this.canvas.height*a*t,this.canvas.width*t,this.canvas.height*t)}else this.context.drawImage(this.canvas,this.canvas.width*s-this.canvas.width*s*i,this.canvas.height*a-this.canvas.height*a*i,this.canvas.width*i,this.canvas.height*i,0,0,this.canvas.width,this.canvas.height);window.clearTimeout(this.updateTimer),this.updateTimer=setTimeout(this.update.bind(this,this.limit),h)}resize(t,e){this.viewport.width*=t/this.canvas.width,this.viewport.height*=e/this.canvas.height,this.canvas.width=t,this.canvas.height=e,this.update(this.limit)}}},235:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.view=void 0;const h=i(447);let s=document.getElementById("coord-x"),a=document.getElementById("coord-y"),n=0,o=0,r=!1;function d(t,e){s.textContent=`X: ${t.toExponential(3)}`,a.textContent=`Y: ${e.toExponential(3)}`}let c=document.getElementById("canvas");c.width=window.innerWidth,c.height=window.innerHeight;let w=new h.ProceduralImageView(c,void 0,1,64,64);e.view=w,window.addEventListener("resize",(()=>w.resize(window.innerWidth,window.innerHeight))),c.addEventListener("pointerdown",(t=>{r=!0,n=t.clientX,o=t.clientY})),c.addEventListener("pointermove",(t=>{r&&(w.pan(Math.round(t.clientX-n),Math.round(t.clientY-o)),n=t.clientX,o=t.clientY)})),c.addEventListener("pointerup",(()=>r=!1)),c.addEventListener("pointerleave",(()=>r=!1)),c.addEventListener("pointercancel",(()=>r=!1)),c.addEventListener("wheel",(t=>{w.zoom(t.clientX,t.clientY,1+.001*t.deltaY,200)})),c.addEventListener("mousemove",(t=>{d(w.viewport.x+t.clientX/c.width*w.viewport.width,w.viewport.y+t.clientY/c.height*w.viewport.height)})),c.addEventListener("mouseleave",(()=>{d(w.viewport.x+.5*w.viewport.width,w.viewport.y+.5*w.viewport.height)})),w.resize(window.innerWidth,window.innerHeight),d(w.viewport.x+.5*w.viewport.width,w.viewport.y+.5*w.viewport.height)}},e={};function i(h){var s=e[h];if(void 0!==s)return s.exports;var a=e[h]={exports:{}};return t[h](a,a.exports,i),a.exports}(()=>{const t=i(235);let e=document.getElementById("limit"),h=0,s=Number(e.value);e.addEventListener("input",(()=>{let i=Number(e.value),a=Number(e.min),n=Number(e.max);i<a?i=a:i>n&&(i=n),i>=a&&i<=n&&function(e,i){clearTimeout(h),h=window.setTimeout((()=>{e!==s&&(t.view.update(e),s=e)}),600)}(i)})),e.addEventListener("change",(()=>{let i=0,a=Number(e.min),n=Number(e.max);""===e.value&&(e.value="30"),i=Number(e.value),i<a?e.value=e.min:i>n&&(e.value=e.max),function(e){clearTimeout(h),e!==s&&(t.view.update(e),s=e)}(Number(e.value))}))})(),(()=>{const t=i(235);let e=document.getElementById("limit"),h=document.getElementById("side-menu"),s=document.getElementById("toggle-menu"),a=document.getElementById("toggle-menu-arrow");s.addEventListener("click",(function(){"240pt"===h.style.width?(h.style.width="0",s.style.marginRight="20pt",a.classList.remove("right"),a.classList.add("left")):(h.style.width="240pt",h.getBoundingClientRect().width,s.style.marginRight="260pt",a.classList.remove("left"),a.classList.add("right"))})),document.getElementById("redraw").onclick=t.view.update.bind(t.view,Number(e.value),void 0),document.getElementById("reset").onclick=t.view.reset.bind(t.view,Number(e.value))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZWNobm9tdW5rLmdpdGh1Yi5pby8uL3NyYy9Qcm9jZWR1cmFsSW1hZ2VWaWV3LnRzIiwid2VicGFjazovL3RlY2hub211bmsuZ2l0aHViLmlvLy4vc3JjL2NhbnZhcy50cyIsIndlYnBhY2s6Ly90ZWNobm9tdW5rLmdpdGh1Yi5pby93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90ZWNobm9tdW5rLmdpdGh1Yi5pby8uL3NyYy9udW1lcmljX2lucHV0LnRzIiwid2VicGFjazovL3RlY2hub211bmsuZ2l0aHViLmlvLy4vc3JjL3NpZGVfbWVudS50cyJdLCJuYW1lcyI6WyJjYW52YXMiLCJ2aWV3cG9ydCIsIndvcmtlckNvdW50IiwiY2h1bmtXaWR0aCIsImNodW5rSGVpZ2h0IiwidGhpcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwicmF0aW8iLCJ3aWR0aCIsImhlaWdodCIsIkRPTVJlY3QiLCJ3aW5kb3ciLCJuYXZpZ2F0b3IiLCJoYXJkd2FyZUNvbmN1cnJlbmN5Iiwid29ya2VycyIsIm5leHRXb3JrZXJJbmRleCIsImxpbWl0IiwidXBkYXRlVGltZXIiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImkiLCJwdXNoIiwiV29ya2VyIiwib25tZXNzYWdlIiwibXNnIiwiZGF0YSIsInB1dEltYWdlRGF0YSIsImltYWdlIiwicGl4ZWxYIiwicGl4ZWxZIiwicmVjdCIsImNodW5rc1giLCJjaHVua3NZIiwiY2xlYXJTdHlsZSIsImZpbGxTdHlsZSIsIm1lc3NhZ2UiLCJ1bmRlZmluZWQiLCJ5IiwiTWF0aCIsIm1pbiIsIngiLCJjcmVhdGVJbWFnZURhdGEiLCJwb3N0TWVzc2FnZSIsImxlbmd0aCIsInVwZGF0ZSIsIm1pZFgiLCJtaWRZIiwicXVhZHJhbnRzIiwiaW1hZ2VEYXRhIiwiZ2V0SW1hZ2VEYXRhIiwic3BsaWNlIiwiZm9yRWFjaCIsInF1YWQiLCJzY2FsZSIsImRlbGF5IiwicmVsWCIsInJlbFkiLCJwb2ludFgiLCJwb2ludFkiLCJpbnZTY2FsZSIsImRyYXdJbWFnZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJiaW5kIiwibGFiZWxYIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxhYmVsWSIsIm1vdXNlWCIsIm1vdXNlWSIsImVuYWJsZVBhbiIsImRpc3BsYXlDb29yZGluYXRlcyIsInRleHRDb250ZW50IiwidG9FeHBvbmVudGlhbCIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsInZpZXciLCJQcm9jZWR1cmFsSW1hZ2VWaWV3IiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlc2l6ZSIsImV2ZW50IiwiY2xpZW50WCIsImNsaWVudFkiLCJwYW4iLCJyb3VuZCIsInpvb20iLCJkZWx0YVkiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsInJlZHJhd1RpbWVyIiwiZHJhd25MaW1pdCIsIk51bWJlciIsInZhbHVlIiwibWF4IiwicmVkcmF3QWZ0ZXJEZWxheSIsInJlZHJhd0ltbWVkaWF0ZWx5Iiwic2lkZU1lbnUiLCJ0b2dnbGVCdXR0b24iLCJhcnJvdyIsInN0eWxlIiwibWFyZ2luUmlnaHQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJvbmNsaWNrIiwicmVzZXQiXSwibWFwcGluZ3MiOiJvSEFHQSw0QkFzQkMsWUFDQ0EsRUFDQUMsRUFDQUMsRUFDQUMsRUFBcUIsR0FDckJDLEVBQXNCLElBTXRCLEdBSkFDLEtBQUtMLE9BQVNBLEVBQ2RLLEtBQUtDLFFBQVVOLEVBQU9PLFdBQVcsTUFDakNGLEtBQUtGLFdBQWFBLEVBQ2xCRSxLQUFLRCxZQUFjQSxPQUNLLElBQWQsRUFBMkIsQ0FFcEMsSUFBSUksRUFBUUgsS0FBS0wsT0FBT1MsTUFBUUosS0FBS0wsT0FBT1UsT0FDNUNMLEtBQUtKLFNBQVcsSUFBSVUsU0FBUyxHQUFLLElBQUlILEdBQVEsSUFBSyxJQUFJQSxFQUFPLFVBRTlESCxLQUFLSixTQUFXQSxFQUVqQkMsRUFBY0EsR0FBZVUsT0FBT0MsVUFBVUMsb0JBQzlDVCxLQUFLVSxRQUFVLEdBQ2ZWLEtBQUtXLGdCQUFrQixFQUN2QlgsS0FBS1ksTUFBUSxHQUNiWixLQUFLYSxZQUFjLEVBQ25CYixLQUFLYyxRQUFVLEVBQ2ZkLEtBQUtlLFFBQVUsRUFFZixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSW5CLElBQWVtQixFQUNsQ2hCLEtBQUtVLFFBQVFPLEtBQUssSUFBSUMsT0FBTyw2QkFDN0JsQixLQUFLVSxRQUFRTSxHQUFHRyxVQUFhQyxJQUN4QkEsRUFBSUMsS0FBS1QsT0FBU1osS0FBS1ksT0FDdkJRLEVBQUlDLEtBQUt6QixTQUFTUSxPQUFTSixLQUFLSixTQUFTUSxPQUN6Q2dCLEVBQUlDLEtBQUt6QixTQUFTUyxRQUFVTCxLQUFLSixTQUFTUyxRQUU3Q0wsS0FBS0MsUUFBUXFCLGFBQ1pGLEVBQUlDLEtBQUtFLE1BQ1RILEVBQUlDLEtBQUtHLE9BQVN4QixLQUFLYyxRQUFVTSxFQUFJQyxLQUFLUCxRQUMxQ00sRUFBSUMsS0FBS0ksT0FBU3pCLEtBQUtlLFFBQVVLLEVBQUlDLEtBQUtOLFVBVS9DLE9BQU9ILEVBQWVjLEdBQ3JCQSxFQUFPQSxHQUFRLElBQUlwQixRQUFRLEVBQUcsRUFBR04sS0FBS0wsT0FBT1MsTUFBT0osS0FBS0wsT0FBT1UsUUFFaEVMLEtBQUtZLE1BQVFBLEVBRWIsSUFBSWUsRUFBVUQsRUFBS3RCLE1BQVFKLEtBQUtGLFdBQy9COEIsRUFBVUYsRUFBS3JCLE9BQVNMLEtBQUtELFlBRVAsTUFBbkJDLEtBQUs2QixhQUNSN0IsS0FBS0MsUUFBUTZCLFVBQVk5QixLQUFLNkIsWUFjL0IsSUFYQSxJQUFJRSxFQUE2QixDQUNoQ1IsV0FBT1MsRUFDUE4sS0FBTSxJQUFJcEIsUUFDVk0sTUFBT1osS0FBS1ksTUFDWmhCLFNBQVVJLEtBQUtKLFNBQ2ZrQixRQUFTZCxLQUFLYyxRQUNkQyxRQUFTZixLQUFLZSxRQUNkUyxPQUFRLEVBQ1JDLE9BQVEsR0FHQVEsRUFBSSxFQUFHQSxFQUFJTCxJQUFXSyxFQUFHLENBQ2pDLElBQUk1QixFQUFTNkIsS0FBS0MsSUFBSVQsRUFBS3JCLE9BQVM0QixFQUFJakMsS0FBS0QsWUFBYUMsS0FBS0QsYUFFL0RnQyxFQUFRTixPQUFTQyxFQUFLTyxFQUFJQSxFQUFJakMsS0FBS0QsWUFDbkNnQyxFQUFRTCxLQUFLTyxFQUFJakMsS0FBS0osU0FBU3FDLEdBQUtQLEVBQUtPLEVBQUlBLEVBQUlqQyxLQUFLRCxhQUFlQyxLQUFLTCxPQUFPVSxPQUFTTCxLQUFLSixTQUFTUyxPQUN4RzBCLEVBQVFMLEtBQUtyQixPQUFTQSxFQUFTTCxLQUFLTCxPQUFPVSxPQUFTTCxLQUFLSixTQUFTUyxPQUVsRSxJQUFLLElBQUkrQixFQUFJLEVBQUdBLEVBQUlULElBQVdTLEVBQUcsQ0FDakMsSUFBSWhDLEVBQVE4QixLQUFLQyxJQUFJVCxFQUFLdEIsTUFBUWdDLEVBQUlwQyxLQUFLRixXQUFZRSxLQUFLRixZQUU1RGlDLEVBQVFQLE9BQVNFLEVBQUtVLEVBQUlBLEVBQUlwQyxLQUFLRixXQUNuQ2lDLEVBQVFMLEtBQUtVLEVBQUlwQyxLQUFLSixTQUFTd0MsR0FBS1YsRUFBS1UsRUFBSUEsRUFBSXBDLEtBQUtGLFlBQWNFLEtBQUtMLE9BQU9TLE1BQVFKLEtBQUtKLFNBQVNRLE1BQ3RHMkIsRUFBUUwsS0FBS3RCLE1BQVFBLEVBQVFKLEtBQUtMLE9BQU9TLE1BQVFKLEtBQUtKLFNBQVNRLE1BRTFDLE1BQWpCMkIsRUFBUVIsT0FBaUJRLEVBQVFSLE1BQU1uQixPQUFTQSxHQUFTMkIsRUFBUVIsTUFBTWxCLFFBQVVBLElBQ3BGMEIsRUFBUVIsTUFBUXZCLEtBQUtDLFFBQVFvQyxnQkFBZ0JqQyxFQUFPQyxJQUdyREwsS0FBS1UsUUFBUVYsS0FBS1csaUJBQWlCMkIsWUFBWVAsR0FDL0MvQixLQUFLVyxpQkFBbUJYLEtBQUtXLGdCQUFrQixHQUFLWCxLQUFLVSxRQUFRNkIsU0FRcEUsTUFBTTNCLEdBQ0wsR0FBSVosS0FBS0wsT0FBT1MsT0FBU0osS0FBS0wsT0FBT1UsT0FBUSxDQUM1QyxJQUFJRixFQUFRSCxLQUFLTCxPQUFPUyxNQUFRSixLQUFLTCxPQUFPVSxPQUM1Q0wsS0FBS0osU0FBVyxJQUFJVSxTQUFTSCxHQUFRLEVBQUcsRUFBRUEsRUFBTyxPQUMzQyxDQUNOLElBQUlBLEVBQVFILEtBQUtMLE9BQU9VLE9BQVNMLEtBQUtMLE9BQU9VLE9BQzdDTCxLQUFLSixTQUFXLElBQUlVLFNBQVMsR0FBSUgsRUFBTyxFQUFHLEVBQUVBLEdBRTlDSCxLQUFLd0MsT0FBTzVCLEdBT2IsSUFBSXdCLEVBQVdILEdBQ2QsSUFBSVEsRUFBT0wsR0FBSyxFQUFJQSxFQUFJcEMsS0FBS0wsT0FBT1MsTUFBUWdDLEVBQzNDTSxFQUFPVCxHQUFLLEVBQUlBLEVBQUlqQyxLQUFLTCxPQUFPVSxPQUFTNEIsRUFDekNVLEVBQXVCLEdBZ0J4QixHQWRBM0MsS0FBS0osU0FBU3dDLEdBQUtBLEVBQUlwQyxLQUFLTCxPQUFPUyxNQUFRSixLQUFLSixTQUFTUSxNQUN6REosS0FBS0osU0FBU3FDLEdBQUtBLEVBQUlqQyxLQUFLTCxPQUFPVSxPQUFTTCxLQUFLSixTQUFTUyxPQUUxREwsS0FBS2MsU0FBV3NCLEVBQ2hCcEMsS0FBS2UsU0FBV2tCLEVBRWhCVSxFQUFZLENBQ1gsSUFBSXJDLFFBQVEsRUFBRyxFQUFHbUMsRUFBTUMsR0FDeEIsSUFBSXBDLFFBQVFtQyxFQUFNLEVBQUd6QyxLQUFLTCxPQUFPUyxNQUFRcUMsRUFBTUMsR0FDL0MsSUFBSXBDLFFBQVEsRUFBR29DLEVBQU1ELEVBQU16QyxLQUFLTCxPQUFPVSxPQUFTcUMsR0FDaEQsSUFBSXBDLFFBQVFtQyxFQUFNQyxFQUFNMUMsS0FBS0wsT0FBT1MsTUFBUXFDLEVBQU16QyxLQUFLTCxPQUFPVSxPQUFTcUMsSUFJcEVOLEVBQUksR0FBS0gsRUFBSSxFQUFHLENBQ25CLElBQUlXLEVBQVk1QyxLQUFLQyxRQUFRNEMsY0FBY1QsR0FBSUgsRUFBR1UsRUFBVSxHQUFHdkMsTUFBT3VDLEVBQVUsR0FBR3RDLFFBQ25GTCxLQUFLQyxRQUFRcUIsYUFBYXNCLEVBQVcsRUFBRyxHQUN4Q0QsRUFBVUcsT0FBTyxFQUFHLFFBQ2QsR0FBSVYsR0FBSyxHQUFLSCxFQUFJLEVBQUcsQ0FDM0IsSUFBSVcsRUFBWTVDLEtBQUtDLFFBQVE0QyxhQUFhLEdBQUlaLEVBQUdVLEVBQVUsR0FBR3ZDLE1BQU91QyxFQUFVLEdBQUd0QyxRQUNsRkwsS0FBS0MsUUFBUXFCLGFBQWFzQixFQUFXUixFQUFHLEdBQ3hDTyxFQUFVRyxPQUFPLEVBQUcsUUFDZCxHQUFJVixFQUFJLEdBQUtILEdBQUssRUFBRyxDQUMzQixJQUFJVyxFQUFZNUMsS0FBS0MsUUFBUTRDLGNBQWNULEVBQUcsRUFBR08sRUFBVSxHQUFHdkMsTUFBT3VDLEVBQVUsR0FBR3RDLFFBQ2xGTCxLQUFLQyxRQUFRcUIsYUFBYXNCLEVBQVcsRUFBR1gsR0FDeENVLEVBQVVHLE9BQU8sRUFBRyxRQUNkLEdBQUlWLEdBQUssR0FBS0gsR0FBSyxFQUFHLENBQzVCLElBQUlXLEVBQVk1QyxLQUFLQyxRQUFRNEMsYUFBYSxFQUFHLEVBQUdGLEVBQVUsR0FBR3ZDLE1BQU91QyxFQUFVLEdBQUd0QyxRQUNqRkwsS0FBS0MsUUFBUXFCLGFBQWFzQixFQUFXUixFQUFHSCxHQUN4Q1UsRUFBVUcsT0FBTyxFQUFHLEdBR3JCSCxFQUFVSSxTQUFRQyxHQUFRaEQsS0FBS3dDLE9BQU94QyxLQUFLWSxNQUFPb0MsS0FTbkQsS0FBS1osRUFBV0gsRUFBV2dCLEVBQWVDLEVBQWdCLEdBQ3pELElBQUlDLEVBQU9mLEVBQUlwQyxLQUFLTCxPQUFPUyxNQUMxQmdELEVBQU9uQixFQUFJakMsS0FBS0wsT0FBT1UsT0FDdkJnRCxFQUFTckQsS0FBS0osU0FBU3dDLEVBQUlwQyxLQUFLSixTQUFTUSxNQUFRK0MsRUFDakRHLEVBQVN0RCxLQUFLSixTQUFTcUMsRUFBSWpDLEtBQUtKLFNBQVNTLE9BQVMrQyxFQVFuRCxHQU5BcEQsS0FBS0osU0FBU1EsT0FBUzZDLEVBQ3ZCakQsS0FBS0osU0FBU1MsUUFBVTRDLEVBQ3hCakQsS0FBS0osU0FBU3dDLEVBQUlpQixFQUFTckQsS0FBS0osU0FBU1EsTUFBUStDLEVBQ2pEbkQsS0FBS0osU0FBU3FDLEVBQUlxQixFQUFTdEQsS0FBS0osU0FBU1MsT0FBUytDLEVBRzlDSCxFQUFRLEVBQUcsQ0FDZCxJQUFJTSxFQUFXLEVBQUlOLEVBQ25CakQsS0FBS0MsUUFBUXVELFVBQ1p4RCxLQUFLTCxPQUNMSyxLQUFLTCxPQUFPUyxNQUFRK0MsRUFBT25ELEtBQUtMLE9BQU9TLE1BQVErQyxFQUFPSSxFQUN0RHZELEtBQUtMLE9BQU9VLE9BQVMrQyxFQUFPcEQsS0FBS0wsT0FBT1UsT0FBUytDLEVBQU9HLEVBQ3hEdkQsS0FBS0wsT0FBT1MsTUFBUW1ELEVBQ3BCdkQsS0FBS0wsT0FBT1UsT0FBU2tELFFBRXRCdkQsS0FBS0MsUUFBUXVELFVBQ1p4RCxLQUFLTCxPQUNMSyxLQUFLTCxPQUFPUyxNQUFRK0MsRUFBT25ELEtBQUtMLE9BQU9TLE1BQVErQyxFQUFPRixFQUN0RGpELEtBQUtMLE9BQU9VLE9BQVMrQyxFQUFPcEQsS0FBS0wsT0FBT1UsT0FBUytDLEVBQU9ILEVBQ3hEakQsS0FBS0wsT0FBT1MsTUFBUTZDLEVBQ3BCakQsS0FBS0wsT0FBT1UsT0FBUzRDLEVBQ3JCLEVBQ0EsRUFDQWpELEtBQUtMLE9BQU9TLE1BQ1pKLEtBQUtMLE9BQU9VLFFBR2RFLE9BQU9rRCxhQUFhekQsS0FBS2EsYUFDekJiLEtBQUthLFlBQWM2QyxXQUFXMUQsS0FBS3dDLE9BQU9tQixLQUFLM0QsS0FBTUEsS0FBS1ksT0FBUXNDLEdBT25FLE9BQU85QyxFQUFlQyxHQUNyQkwsS0FBS0osU0FBU1EsT0FBU0EsRUFBUUosS0FBS0wsT0FBT1MsTUFDM0NKLEtBQUtKLFNBQVNTLFFBQVVBLEVBQVNMLEtBQUtMLE9BQU9VLE9BQzdDTCxLQUFLTCxPQUFPUyxNQUFRQSxFQUNwQkosS0FBS0wsT0FBT1UsT0FBU0EsRUFDckJMLEtBQUt3QyxPQUFPeEMsS0FBS1ksVSw2RUNwT25CLGVBVUEsSUFBSWdELEVBQVNDLFNBQVNDLGVBQWUsV0FDcENDLEVBQVNGLFNBQVNDLGVBQWUsV0FDakNFLEVBQVMsRUFBR0MsRUFBUyxFQUNyQkMsR0FBWSxFQVFiLFNBQVNDLEVBQW1CL0IsRUFBV0gsR0FDdEMyQixFQUFPUSxZQUFjLE1BQU1oQyxFQUFFaUMsY0FBYyxLQUMzQ04sRUFBT0ssWUFBYyxNQUFNbkMsRUFBRW9DLGNBQWMsS0FHNUMsSUFBSTFFLEVBQVNrRSxTQUFTQyxlQUFlLFVBQ3JDbkUsRUFBT1MsTUFBUUcsT0FBTytELFdBQ3RCM0UsRUFBT1UsT0FBU0UsT0FBT2dFLFlBQ3ZCLElBQUlDLEVBQU8sSUFBSSxFQUFBQyxvQkFBb0I5RSxPQUFRcUMsRUFBVyxFQUFHLEdBQUksSUFpRHBELEVBQUF3QyxPQTdDVGpFLE9BQU9tRSxpQkFBaUIsVUFBVSxJQUFNRixFQUFLRyxPQUFPcEUsT0FBTytELFdBQVkvRCxPQUFPZ0UsZUFFOUU1RSxFQUFPK0UsaUJBQWlCLGVBQWVFLElBQ3RDVixHQUFZLEVBQ1pGLEVBQVNZLEVBQU1DLFFBQ2ZaLEVBQVNXLEVBQU1FLFdBRWhCbkYsRUFBTytFLGlCQUFpQixlQUFlRSxJQUNsQ1YsSUFDSE0sRUFBS08sSUFBSTdDLEtBQUs4QyxNQUFNSixFQUFNQyxRQUFVYixHQUFTOUIsS0FBSzhDLE1BQU1KLEVBQU1FLFFBQVViLElBQ3hFRCxFQUFTWSxFQUFNQyxRQUNmWixFQUFTVyxFQUFNRSxZQUdqQm5GLEVBQU8rRSxpQkFBaUIsYUFBYSxJQUFNUixHQUFZLElBQ3ZEdkUsRUFBTytFLGlCQUFpQixnQkFBZ0IsSUFBTVIsR0FBWSxJQUMxRHZFLEVBQU8rRSxpQkFBaUIsaUJBQWlCLElBQU1SLEdBQVksSUFFM0R2RSxFQUFPK0UsaUJBQWlCLFNBQVNFLElBQ2hDSixFQUFLUyxLQUFLTCxFQUFNQyxRQUFTRCxFQUFNRSxRQUFTLEVBaERmLEtBZ0RtQkYsRUFBTU0sT0EvQ3hCLFFBd0QzQnZGLEVBQU8rRSxpQkFBaUIsYUFBYUUsSUFDcENULEVBQ0NLLEVBQUs1RSxTQUFTd0MsRUFBSXdDLEVBQU1DLFFBQVVsRixFQUFPUyxNQUFRb0UsRUFBSzVFLFNBQVNRLE1BQy9Eb0UsRUFBSzVFLFNBQVNxQyxFQUFJMkMsRUFBTUUsUUFBVW5GLEVBQU9VLE9BQVNtRSxFQUFLNUUsU0FBU1MsV0FFbEVWLEVBQU8rRSxpQkFBaUIsY0FBYyxLQUNyQ1AsRUFDQ0ssRUFBSzVFLFNBQVN3QyxFQUF3QixHQUFwQm9DLEVBQUs1RSxTQUFTUSxNQUNoQ29FLEVBQUs1RSxTQUFTcUMsRUFBeUIsR0FBckJ1QyxFQUFLNUUsU0FBU1MsV0FHbENtRSxFQUFLRyxPQUFPcEUsT0FBTytELFdBQVkvRCxPQUFPZ0UsYUFFdENKLEVBQ0NLLEVBQUs1RSxTQUFTd0MsRUFBd0IsR0FBcEJvQyxFQUFLNUUsU0FBU1EsTUFDaENvRSxFQUFLNUUsU0FBU3FDLEVBQXlCLEdBQXJCdUMsRUFBSzVFLFNBQVNTLFVDM0U3QjhFLEVBQTJCLEdBRy9CLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJyRCxJQUFqQnNELEVBQ0gsT0FBT0EsRUFBYUMsUUFHckIsSUFBSUMsRUFBU0wsRUFBeUJFLEdBQVksQ0FHakRFLFFBQVMsSUFPVixPQUhBRSxFQUFvQkosR0FBVUcsRUFBUUEsRUFBT0QsUUFBU0gsR0FHL0NJLEVBQU9ELFEsTUNyQmYsZUFRQSxJQUFJM0UsRUFBUWlELFNBQVNDLGVBQWUsU0FDbkM0QixFQUFjLEVBQ2RDLEVBQWFDLE9BQU9oRixFQUFNaUYsT0FpQzNCakYsRUFBTThELGlCQUFpQixTQUFTLEtBQy9CLElBQUltQixFQUFRRCxPQUFPaEYsRUFBTWlGLE9BQ3hCMUQsRUFBTXlELE9BQU9oRixFQUFNdUIsS0FDbkIyRCxFQUFNRixPQUFPaEYsRUFBTWtGLEtBRWhCRCxFQUFRMUQsRUFDWDBELEVBQVExRCxFQUNFMEQsRUFBUUMsSUFDbEJELEVBQVFDLEdBR0xELEdBQVMxRCxHQUFPMEQsR0FBU0MsR0FwQzlCLFNBQTBCbEYsRUFBZXNDLEdBQ3hDTyxhQUFhaUMsR0FDYkEsRUFBY25GLE9BQU9tRCxZQUNwQixLQUNLOUMsSUFBVStFLElBQ2IsRUFBQW5CLEtBQUtoQyxPQUFPNUIsR0FDWitFLEVBQWEvRSxLQXBCSSxLQW1EbkJtRixDQUFpQkYsTUFHbkJqRixFQUFNOEQsaUJBQWlCLFVBQVUsS0FDaEMsSUFBSW1CLEVBQVEsRUFDWjFELEVBQU15RCxPQUFPaEYsRUFBTXVCLEtBQ25CMkQsRUFBTUYsT0FBT2hGLEVBQU1rRixLQUdDLEtBQWhCbEYsRUFBTWlGLFFBQ1RqRixFQUFNaUYsTUFBUSxNQUdmQSxFQUFRRCxPQUFPaEYsRUFBTWlGLE9BRWpCQSxFQUFRMUQsRUFDWHZCLEVBQU1pRixNQUFRakYsRUFBTXVCLElBQ1YwRCxFQUFRQyxJQUNsQmxGLEVBQU1pRixNQUFRakYsRUFBTWtGLEtBeEN0QixTQUEyQmxGLEdBQzFCNkMsYUFBYWlDLEdBQ1Q5RSxJQUFVK0UsSUFDYixFQUFBbkIsS0FBS2hDLE9BQU81QixHQUNaK0UsRUFBYS9FLEdBdUNkb0YsQ0FBa0JKLE9BQU9oRixFQUFNaUYsWSxTQzVFaEMsZUFTQSxJQUFJakYsRUFBUWlELFNBQVNDLGVBQWUsU0FDbkNtQyxFQUFXcEMsU0FBU0MsZUFBZSxhQUNuQ29DLEVBQWVyQyxTQUFTQyxlQUFlLGVBQ3ZDcUMsRUFBUXRDLFNBQVNDLGVBQWUscUJBa0NqQ29DLEVBQWF4QixpQkFBaUIsU0FWOUIsV0FDOEIsVUFBekJ1QixFQUFTRyxNQUFNaEcsT0FSbkI2RixFQUFTRyxNQUFNaEcsTUFBUSxJQUN2QjhGLEVBQWFFLE1BQU1DLFlBQWMsT0FDakNGLEVBQU1HLFVBQVVDLE9BQU8sU0FDdkJKLEVBQU1HLFVBQVVFLElBQUksVUFacEJQLEVBQVNHLE1BQU1oRyxNQUFRLFFBQ1A2RixFQUFTUSx3QkFBd0JyRyxNQUNqRDhGLEVBQWFFLE1BQU1DLFlBQWMsUUFDakNGLEVBQU1HLFVBQVVDLE9BQU8sUUFDdkJKLEVBQU1HLFVBQVVFLElBQUksYUF1QnJCM0MsU0FBU0MsZUFBZSxVQUFXNEMsUUFBVSxFQUFBbEMsS0FBS2hDLE9BQU9tQixLQUFLLEVBQUFhLEtBQU1vQixPQUFPaEYsRUFBTWlGLFlBQVE3RCxHQUN6RjZCLFNBQVNDLGVBQWUsU0FBVTRDLFFBQVUsRUFBQWxDLEtBQUttQyxNQUFNaEQsS0FBSyxFQUFBYSxLQUFNb0IsT0FBT2hGLEVBQU1pRixTIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBBIHZpZXcgb2YgYSBwcm9jZWR1cmFsIGltYWdlIHRoYXQgY2FuIGJlIHBhbm5lZCBvciB6b29tZWQuXHJcbiAqIFRha2VzIGEgY2FudmFzIGVsZW1lbnQgdG8gZHJhdyB0aGUgaW1hZ2Ugb24uIERvZXMgbm90IGNhcHR1cmUgaW5wdXRzLCBvbmx5IGhhbmRsZXMgZHJhd2luZyB0aGUgYWN0dWFsIGltYWdlLiBcclxuICovXHJcbmV4cG9ydCBjbGFzcyBQcm9jZWR1cmFsSW1hZ2VWaWV3IHtcclxuXHRjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG5cdGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHRjaHVua1dpZHRoOiBudW1iZXI7XHJcblx0Y2h1bmtIZWlnaHQ6IG51bWJlcjtcclxuXHR2aWV3cG9ydDogRE9NUmVjdDtcclxuXHRjbGVhclN0eWxlPzogc3RyaW5nIHwgQ2FudmFzR3JhZGllbnQgfCBDYW52YXNQYXR0ZXJuO1xyXG5cclxuXHR3b3JrZXJzOiBBcnJheTxXb3JrZXI+O1xyXG5cdG5leHRXb3JrZXJJbmRleDogbnVtYmVyO1xyXG5cdGxpbWl0OiBudW1iZXI7XHJcblx0dXBkYXRlVGltZXI6IG51bWJlcjtcclxuXHRvZmZzZXRYOiBudW1iZXI7XHJcblx0b2Zmc2V0WTogbnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50fSBjYW52YXMgVGhlIGNhbnZhcyB0byB1c2UuXHJcblx0ICogQHBhcmFtIHtET01SZWN0fSB2aWV3cG9ydCBUaGUgdmlld2VkIHJlZ2lvbiBvZiB0aGUgaW1hZ2UuXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHdvcmtlckNvdW50IE51bWJlciBvZiBiYWNrZ3JvdW5kIHdvcmtlcnMgdG8gdXNlLiBNdXN0IGJlIGF0IGxlYXN0IDEuXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGNodW5rV2lkdGggV2lkdGggb2YgYSBzaW5nbGUgY2h1bmsgb2YgdGhlIHByb2Nlc3NlZCBpbWFnZSBpbiBwaXhlbHMuXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGNodW5rSGVpZ2h0IEhlaWdodCBvZiBhIHNpbmdsZSBjaHVuayBvZiB0aGUgcHJvY2Vzc2VkIGltYWdlIGluIHBpeGVscy5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihcclxuXHRcdGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXHJcblx0XHR2aWV3cG9ydD86IERPTVJlY3QsXHJcblx0XHR3b3JrZXJDb3VudD86IG51bWJlcixcclxuXHRcdGNodW5rV2lkdGg6IG51bWJlciA9IDY0LFxyXG5cdFx0Y2h1bmtIZWlnaHQ6IG51bWJlciA9IDY0LFxyXG5cdCkge1xyXG5cdFx0dGhpcy5jYW52YXMgPSBjYW52YXM7XHJcblx0XHR0aGlzLmNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSE7XHJcblx0XHR0aGlzLmNodW5rV2lkdGggPSBjaHVua1dpZHRoO1xyXG5cdFx0dGhpcy5jaHVua0hlaWdodCA9IGNodW5rSGVpZ2h0O1xyXG5cdFx0aWYgKHR5cGVvZih2aWV3cG9ydCkgPT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHQvLyBEZWZhdWx0IHZpZXdwb3J0IGNlbnRlcnMgYXJvdW5kIC0xIGJlY2F1c2UgdGhlIG1hbmRlbGJyb3QgbG9vayBiZXR0ZXIgdGhhdCB3YXkuXHJcblx0XHRcdGxldCByYXRpbyA9IHRoaXMuY2FudmFzLndpZHRoIC8gdGhpcy5jYW52YXMuaGVpZ2h0O1xyXG5cdFx0XHR0aGlzLnZpZXdwb3J0ID0gbmV3IERPTVJlY3QoLS44IC0gMS4xKnJhdGlvLCAtMS4xLCAyLjIqcmF0aW8sIDIuMik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7XHJcblx0XHR9XHJcblx0XHR3b3JrZXJDb3VudCA9IHdvcmtlckNvdW50IHx8IHdpbmRvdy5uYXZpZ2F0b3IuaGFyZHdhcmVDb25jdXJyZW5jeTtcclxuXHRcdHRoaXMud29ya2VycyA9IFtdO1xyXG5cdFx0dGhpcy5uZXh0V29ya2VySW5kZXggPSAwO1xyXG5cdFx0dGhpcy5saW1pdCA9IDMwO1xyXG5cdFx0dGhpcy51cGRhdGVUaW1lciA9IDA7XHJcblx0XHR0aGlzLm9mZnNldFggPSAwO1xyXG5cdFx0dGhpcy5vZmZzZXRZID0gMDtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHdvcmtlckNvdW50OyArK2kpIHtcclxuXHRcdFx0dGhpcy53b3JrZXJzLnB1c2gobmV3IFdvcmtlcignLi9zY3JpcHRzL2RyYXdfd29ya2VyLmpzJykpO1xyXG5cdFx0XHR0aGlzLndvcmtlcnNbaV0ub25tZXNzYWdlID0gKG1zZykgPT4ge1xyXG5cdFx0XHRcdGlmIChtc2cuZGF0YS5saW1pdCA9PSB0aGlzLmxpbWl0XHJcblx0XHRcdFx0XHQmJiBtc2cuZGF0YS52aWV3cG9ydC53aWR0aCA9PSB0aGlzLnZpZXdwb3J0LndpZHRoXHJcblx0XHRcdFx0XHQmJiBtc2cuZGF0YS52aWV3cG9ydC5oZWlnaHQgPT0gdGhpcy52aWV3cG9ydC5oZWlnaHRcclxuXHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdHRoaXMuY29udGV4dC5wdXRJbWFnZURhdGEoXHJcblx0XHRcdFx0XHRcdG1zZy5kYXRhLmltYWdlLFxyXG5cdFx0XHRcdFx0XHRtc2cuZGF0YS5waXhlbFggKyB0aGlzLm9mZnNldFggLSBtc2cuZGF0YS5vZmZzZXRYLFxyXG5cdFx0XHRcdFx0XHRtc2cuZGF0YS5waXhlbFkgKyB0aGlzLm9mZnNldFkgLSBtc2cuZGF0YS5vZmZzZXRZKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKiogVXBkYXRlIHBhcnQgb2YgdGhlIHZpZXdlZCBpbWFnZS5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbGltaXQgTWF4aW11bSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byB1c2Ugd2hlbiBkcmF3aW5nIHRoZSBpbWFnZS4gXHJcblx0ICogQHBhcmFtIHtET01SZWN0fSByZWN0IFRoZSByZWdpb24gb2YgdGhlIGltYWdlIHRvIHJlZHJhdyAoaW4gcGl4ZWxzKS4gRGVmYXVsdHMgdG8gdGhlIHdob2xlIGltYWdlIGlmIG51bGwuXHJcblx0ICovXHJcblx0dXBkYXRlKGxpbWl0OiBudW1iZXIsIHJlY3Q/OiBET01SZWN0KSB7XHJcblx0XHRyZWN0ID0gcmVjdCB8fCBuZXcgRE9NUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuXHJcblx0XHR0aGlzLmxpbWl0ID0gbGltaXQ7XHJcblxyXG5cdFx0bGV0IGNodW5rc1ggPSByZWN0LndpZHRoIC8gdGhpcy5jaHVua1dpZHRoLFxyXG5cdFx0XHRjaHVua3NZID0gcmVjdC5oZWlnaHQgLyB0aGlzLmNodW5rSGVpZ2h0O1xyXG5cclxuXHRcdGlmICh0aGlzLmNsZWFyU3R5bGUgIT0gbnVsbCkge1xyXG5cdFx0XHR0aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5jbGVhclN0eWxlO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR2YXIgbWVzc2FnZTogRHJhd1JlZ2lvbk1lc3NhZ2UgPSB7XHJcblx0XHRcdGltYWdlOiB1bmRlZmluZWQsXHJcblx0XHRcdHJlY3Q6IG5ldyBET01SZWN0KCksXHJcblx0XHRcdGxpbWl0OiB0aGlzLmxpbWl0LFxyXG5cdFx0XHR2aWV3cG9ydDogdGhpcy52aWV3cG9ydCxcclxuXHRcdFx0b2Zmc2V0WDogdGhpcy5vZmZzZXRYLFxyXG5cdFx0XHRvZmZzZXRZOiB0aGlzLm9mZnNldFksXHJcblx0XHRcdHBpeGVsWDogMCxcclxuXHRcdFx0cGl4ZWxZOiAwLFxyXG5cdFx0fTtcclxuXHJcblx0XHRmb3IgKHZhciB5ID0gMDsgeSA8IGNodW5rc1k7ICsreSkge1xyXG5cdFx0XHR2YXIgaGVpZ2h0ID0gTWF0aC5taW4ocmVjdC5oZWlnaHQgLSB5ICogdGhpcy5jaHVua0hlaWdodCwgdGhpcy5jaHVua0hlaWdodCk7XHJcblxyXG5cdFx0XHRtZXNzYWdlLnBpeGVsWSA9IHJlY3QueSArIHkgKiB0aGlzLmNodW5rSGVpZ2h0O1xyXG5cdFx0XHRtZXNzYWdlLnJlY3QueSA9IHRoaXMudmlld3BvcnQueSArIChyZWN0LnkgKyB5ICogdGhpcy5jaHVua0hlaWdodCkgLyB0aGlzLmNhbnZhcy5oZWlnaHQgKiB0aGlzLnZpZXdwb3J0LmhlaWdodDtcclxuXHRcdFx0bWVzc2FnZS5yZWN0LmhlaWdodCA9IGhlaWdodCAvIHRoaXMuY2FudmFzLmhlaWdodCAqIHRoaXMudmlld3BvcnQuaGVpZ2h0O1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgeCA9IDA7IHggPCBjaHVua3NYOyArK3gpIHtcclxuXHRcdFx0XHR2YXIgd2lkdGggPSBNYXRoLm1pbihyZWN0LndpZHRoIC0geCAqIHRoaXMuY2h1bmtXaWR0aCwgdGhpcy5jaHVua1dpZHRoKTtcclxuXHJcblx0XHRcdFx0bWVzc2FnZS5waXhlbFggPSByZWN0LnggKyB4ICogdGhpcy5jaHVua1dpZHRoO1xyXG5cdFx0XHRcdG1lc3NhZ2UucmVjdC54ID0gdGhpcy52aWV3cG9ydC54ICsgKHJlY3QueCArIHggKiB0aGlzLmNodW5rV2lkdGgpIC8gdGhpcy5jYW52YXMud2lkdGggKiB0aGlzLnZpZXdwb3J0LndpZHRoO1xyXG5cdFx0XHRcdG1lc3NhZ2UucmVjdC53aWR0aCA9IHdpZHRoIC8gdGhpcy5jYW52YXMud2lkdGggKiB0aGlzLnZpZXdwb3J0LndpZHRoO1xyXG5cclxuXHRcdFx0XHRpZiAobWVzc2FnZS5pbWFnZSA9PSBudWxsIHx8IG1lc3NhZ2UuaW1hZ2Uud2lkdGggIT0gd2lkdGggfHwgbWVzc2FnZS5pbWFnZS5oZWlnaHQgIT0gaGVpZ2h0KSB7XHJcblx0XHRcdFx0XHRtZXNzYWdlLmltYWdlID0gdGhpcy5jb250ZXh0LmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMud29ya2Vyc1t0aGlzLm5leHRXb3JrZXJJbmRleF0ucG9zdE1lc3NhZ2UobWVzc2FnZSk7XHJcblx0XHRcdFx0dGhpcy5uZXh0V29ya2VySW5kZXggPSAodGhpcy5uZXh0V29ya2VySW5kZXggKyAxKSAlIHRoaXMud29ya2Vycy5sZW5ndGg7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKiBSZXNldCB0aGUgdmlld3BvcnQgdG8gZGVmYXVsdCBzdGF0ZSBhbmQgcmVkcmF3IHRoZSBpbWFnZSB3aXRoIHByb3ZpZGVkIGxpbWl0LlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBsaW1pdCBNYXhpbXVtIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIHVzZSB3aGVuIGRyYXdpbmcgdGhlIGltYWdlLlxyXG5cdCAqL1xyXG5cdHJlc2V0KGxpbWl0OiBudW1iZXIpIHtcclxuXHRcdGlmICh0aGlzLmNhbnZhcy53aWR0aCA+PSB0aGlzLmNhbnZhcy5oZWlnaHQpIHtcclxuXHRcdFx0bGV0IHJhdGlvID0gdGhpcy5jYW52YXMud2lkdGggLyB0aGlzLmNhbnZhcy5oZWlnaHQ7XHJcblx0XHRcdHRoaXMudmlld3BvcnQgPSBuZXcgRE9NUmVjdCgtcmF0aW8sIC0xLCAyKnJhdGlvLCAyKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGxldCByYXRpbyA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMuY2FudmFzLmhlaWdodDtcclxuXHRcdFx0dGhpcy52aWV3cG9ydCA9IG5ldyBET01SZWN0KC0xLCAtcmF0aW8sIDIsIDIqcmF0aW8pO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy51cGRhdGUobGltaXQpO1xyXG5cdH1cclxuXHJcblx0LyoqIFNoaWZ0IHRoZWUgaW1hZ2UgcHJvdmlkZWQgbnVtYmVyIG9mIHBpeGVscy5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0geCBIb3Jpem9udGFsIG51bWJlciBvZiBwaXhlbHMgdG8gc2hpZnQgdGhlIGltYWdlIGJ5LlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5IFZlcnRpY2FsIG51bWJlciBvZiBwaXhlbHMgdG8gc2hpZnQgdGhlIGltYWdlIGJ5LlxyXG5cdCAqL1xyXG5cdHBhbih4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG5cdFx0bGV0IG1pZFggPSB4ID49IDAgPyB4IDogdGhpcy5jYW52YXMud2lkdGggKyB4LFxyXG5cdFx0XHRtaWRZID0geSA+PSAwID8geSA6IHRoaXMuY2FudmFzLmhlaWdodCArIHksXHJcblx0XHRcdHF1YWRyYW50czogRE9NUmVjdFtdID0gW107XHJcblx0XHRcclxuXHRcdHRoaXMudmlld3BvcnQueCAtPSB4IC8gdGhpcy5jYW52YXMud2lkdGggKiB0aGlzLnZpZXdwb3J0LndpZHRoO1xyXG5cdFx0dGhpcy52aWV3cG9ydC55IC09IHkgLyB0aGlzLmNhbnZhcy5oZWlnaHQgKiB0aGlzLnZpZXdwb3J0LmhlaWdodDtcclxuXHJcblx0XHR0aGlzLm9mZnNldFggKz0geDtcclxuXHRcdHRoaXMub2Zmc2V0WSArPSB5O1xyXG5cclxuXHRcdHF1YWRyYW50cyA9IFtcclxuXHRcdFx0bmV3IERPTVJlY3QoMCwgMCwgbWlkWCwgbWlkWSksXHJcblx0XHRcdG5ldyBET01SZWN0KG1pZFgsIDAsIHRoaXMuY2FudmFzLndpZHRoIC0gbWlkWCwgbWlkWSksXHJcblx0XHRcdG5ldyBET01SZWN0KDAsIG1pZFksIG1pZFgsIHRoaXMuY2FudmFzLmhlaWdodCAtIG1pZFkpLFxyXG5cdFx0XHRuZXcgRE9NUmVjdChtaWRYLCBtaWRZLCB0aGlzLmNhbnZhcy53aWR0aCAtIG1pZFgsIHRoaXMuY2FudmFzLmhlaWdodCAtIG1pZFkpLFxyXG5cdFx0XTtcclxuXHJcblx0XHQvLyBSZW1vdmUgdGhlIGNsZWFuIHF1YWRyYW50LlxyXG5cdFx0aWYgKHggPCAwICYmIHkgPCAwKSB7XHJcblx0XHRcdGxldCBpbWFnZURhdGEgPSB0aGlzLmNvbnRleHQuZ2V0SW1hZ2VEYXRhKC14LCAteSwgcXVhZHJhbnRzWzBdLndpZHRoLCBxdWFkcmFudHNbMF0uaGVpZ2h0KTtcclxuXHRcdFx0dGhpcy5jb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApO1xyXG5cdFx0XHRxdWFkcmFudHMuc3BsaWNlKDAsIDEpO1xyXG5cdFx0fSBlbHNlIGlmICh4ID49IDAgJiYgeSA8IDApIHtcclxuXHRcdFx0bGV0IGltYWdlRGF0YSA9IHRoaXMuY29udGV4dC5nZXRJbWFnZURhdGEoMCwgLXksIHF1YWRyYW50c1sxXS53aWR0aCwgcXVhZHJhbnRzWzFdLmhlaWdodCk7XHJcblx0XHRcdHRoaXMuY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCB4LCAwKTtcclxuXHRcdFx0cXVhZHJhbnRzLnNwbGljZSgxLCAxKTtcclxuXHRcdH0gZWxzZSBpZiAoeCA8IDAgJiYgeSA+PSAwKSB7XHJcblx0XHRcdGxldCBpbWFnZURhdGEgPSB0aGlzLmNvbnRleHQuZ2V0SW1hZ2VEYXRhKC14LCAwLCBxdWFkcmFudHNbMl0ud2lkdGgsIHF1YWRyYW50c1syXS5oZWlnaHQpO1xyXG5cdFx0XHR0aGlzLmNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgeSk7XHJcblx0XHRcdHF1YWRyYW50cy5zcGxpY2UoMiwgMSk7XHJcblx0XHR9IGVsc2UgaWYgKHggPj0gMCAmJiB5ID49IDApIHtcclxuXHRcdFx0bGV0IGltYWdlRGF0YSA9IHRoaXMuY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgcXVhZHJhbnRzWzNdLndpZHRoLCBxdWFkcmFudHNbM10uaGVpZ2h0KTtcclxuXHRcdFx0dGhpcy5jb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIHgsIHkpO1xyXG5cdFx0XHRxdWFkcmFudHMuc3BsaWNlKDMsIDEpO1xyXG5cdFx0fVxyXG5cdFxyXG5cdFx0cXVhZHJhbnRzLmZvckVhY2gocXVhZCA9PiB0aGlzLnVwZGF0ZSh0aGlzLmxpbWl0LCBxdWFkKSk7XHJcblx0fVxyXG5cclxuXHQvKiogWm9vbSB0aGUgaW1hZ2UgaW4gb3Igb3V0IGFyb3VuZCBhIHByb3ZpZGVkIHBvaW50LlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IFRoZSBob3Jpem9udGFsIGluZGV4IG9mIHRoZSBwaXhlbCBhcm91bmQgd2hpY2ggdG8gem9vbS5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSBUaGUgdmVydGljYWwgaW5kZXggb2YgdGhlIHBpeGVsIGFyb3VuZCB3aGljaCB0byB6b29tLlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsZSBUaGUgcmF0aW8gYnkgaG93IG11Y2ggdG8gem9vbSB0aGUgcGljdHVyZS5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZGVsYXkgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgcmVkcmF3aW5nIHRoZSBpbWFnZS5cclxuXHQgKi9cclxuXHR6b29tKHg6IG51bWJlciwgeTogbnVtYmVyLCBzY2FsZTogbnVtYmVyLCBkZWxheTogbnVtYmVyID0gMCkge1xyXG5cdFx0bGV0IHJlbFggPSB4IC8gdGhpcy5jYW52YXMud2lkdGgsXHJcblx0XHRcdHJlbFkgPSB5IC8gdGhpcy5jYW52YXMuaGVpZ2h0LFxyXG5cdFx0XHRwb2ludFggPSB0aGlzLnZpZXdwb3J0LnggKyB0aGlzLnZpZXdwb3J0LndpZHRoICogcmVsWCxcclxuXHRcdFx0cG9pbnRZID0gdGhpcy52aWV3cG9ydC55ICsgdGhpcy52aWV3cG9ydC5oZWlnaHQgKiByZWxZO1xyXG5cdFx0XHJcblx0XHR0aGlzLnZpZXdwb3J0LndpZHRoICo9IHNjYWxlO1xyXG5cdFx0dGhpcy52aWV3cG9ydC5oZWlnaHQgKj0gc2NhbGU7XHJcblx0XHR0aGlzLnZpZXdwb3J0LnggPSBwb2ludFggLSB0aGlzLnZpZXdwb3J0LndpZHRoICogcmVsWDtcclxuXHRcdHRoaXMudmlld3BvcnQueSA9IHBvaW50WSAtIHRoaXMudmlld3BvcnQuaGVpZ2h0ICogcmVsWTtcclxuXHJcblx0XHQvLyBSZXVzZSB0aGUgZXhpc3RlbnQgaW1hZ2Ugd2hpbGUgdGhlIHdvcmtlcnMgYXJlIHJlZHJhd2luZyBpdC5cclxuXHRcdGlmIChzY2FsZSA+IDEpIHtcclxuXHRcdFx0bGV0IGludlNjYWxlID0gMSAvIHNjYWxlO1xyXG5cdFx0XHR0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLndpZHRoICogcmVsWCAtIHRoaXMuY2FudmFzLndpZHRoICogcmVsWCAqIGludlNjYWxlLFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLmhlaWdodCAqIHJlbFkgLSB0aGlzLmNhbnZhcy5oZWlnaHQgKiByZWxZICogaW52U2NhbGUsXHJcblx0XHRcdFx0dGhpcy5jYW52YXMud2lkdGggKiBpbnZTY2FsZSxcclxuXHRcdFx0XHR0aGlzLmNhbnZhcy5oZWlnaHQgKiBpbnZTY2FsZSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLndpZHRoICogcmVsWCAtIHRoaXMuY2FudmFzLndpZHRoICogcmVsWCAqIHNjYWxlLFxyXG5cdFx0XHRcdHRoaXMuY2FudmFzLmhlaWdodCAqIHJlbFkgLSB0aGlzLmNhbnZhcy5oZWlnaHQgKiByZWxZICogc2NhbGUsXHJcblx0XHRcdFx0dGhpcy5jYW52YXMud2lkdGggKiBzY2FsZSxcclxuXHRcdFx0XHR0aGlzLmNhbnZhcy5oZWlnaHQgKiBzY2FsZSxcclxuXHRcdFx0XHQwLFxyXG5cdFx0XHRcdDAsXHJcblx0XHRcdFx0dGhpcy5jYW52YXMud2lkdGgsXHJcblx0XHRcdFx0dGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuXHRcdH1cclxuXHJcblx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudXBkYXRlVGltZXIpO1xyXG5cdFx0dGhpcy51cGRhdGVUaW1lciA9IHNldFRpbWVvdXQodGhpcy51cGRhdGUuYmluZCh0aGlzLCB0aGlzLmxpbWl0KSwgZGVsYXkpO1xyXG5cdH1cclxuXHJcblx0LyoqIFJlc2l6ZSB0aGUgdmlldy5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggVGhlIG5ldyB3aWR0aCBvZiB0aGUgdmlldyBpbiBwaXhlbHMuXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBUaGUgbmV3IGhlaWdodCBvZiB0aGUgdmlldyBpbiBwaXhlbHMuXHJcblx0ICovXHJcblx0cmVzaXplKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XHJcblx0XHR0aGlzLnZpZXdwb3J0LndpZHRoICo9IHdpZHRoIC8gdGhpcy5jYW52YXMud2lkdGg7XHJcblx0XHR0aGlzLnZpZXdwb3J0LmhlaWdodCAqPSBoZWlnaHQgLyB0aGlzLmNhbnZhcy5oZWlnaHQ7XHJcblx0XHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG5cdFx0dGhpcy5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xyXG5cdFx0dGhpcy51cGRhdGUodGhpcy5saW1pdCk7XHJcblx0fVxyXG59XHJcbiIsImltcG9ydCB7IFByb2NlZHVyYWxJbWFnZVZpZXcgfSBmcm9tIFwiLi9Qcm9jZWR1cmFsSW1hZ2VWaWV3XCI7XHJcblxyXG4vLyBDb25zdGFudHNcclxuXHJcbmNvbnN0IFdIRUVMX1NFTlNJVElWSVRZID0gMWUtMztcclxuY29uc3QgV0hFRUxfUkVEUkFXX0RFTEFZID0gMjAwO1xyXG5jb25zdCBHRVNUVVJFX1NDQUxFX0RFTEFZID0gNjAwO1xyXG5cclxuLy8gR2xvYmFsIHZhcmlhYmxlc1xyXG5cclxubGV0IGxhYmVsWCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb29yZC14JykgYXMgSFRNTEVsZW1lbnQsXHJcblx0bGFiZWxZID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvb3JkLXknKSBhcyBIVE1MRWxlbWVudCxcclxuXHRtb3VzZVggPSAwLCBtb3VzZVkgPSAwLFxyXG5cdGVuYWJsZVBhbiA9IGZhbHNlO1xyXG5cclxuLy8gRnJlZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnNcclxuXHJcbi8qKiBTZXQgdGhlIGNvb3JkaW5hdGVzIHRvIGRpc3BsYXkgcHJvdmlkZWQgdmFsdWVzLlxyXG4gKiBAcGFyYW0ge251bWJlcn0geCBUaGUgaG9yaXpvbnRhbCBjb29yZGluYXRlIHRvIGRpc3BsYXkuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSB5IFRoZSB2ZXJ0aWNhbCBjb29yZGluYXRlIHRvIGRpc3BsYXkuXHJcbiAqL1xyXG5mdW5jdGlvbiBkaXNwbGF5Q29vcmRpbmF0ZXMoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuXHRsYWJlbFgudGV4dENvbnRlbnQgPSBgWDogJHt4LnRvRXhwb25lbnRpYWwoMyl9YDtcclxuXHRsYWJlbFkudGV4dENvbnRlbnQgPSBgWTogJHt5LnRvRXhwb25lbnRpYWwoMyl9YDtcclxufVxyXG5cclxubGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcclxuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbmxldCB2aWV3ID0gbmV3IFByb2NlZHVyYWxJbWFnZVZpZXcoY2FudmFzLCB1bmRlZmluZWQsIDEsIDY0LCA2NCk7XHJcblxyXG4vLyBSZWdpc3RlciBldmVudHNcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB2aWV3LnJlc2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KSk7XHJcblxyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBldmVudCA9PiB7XHJcblx0ZW5hYmxlUGFuID0gdHJ1ZTtcclxuXHRtb3VzZVggPSBldmVudC5jbGllbnRYO1xyXG5cdG1vdXNlWSA9IGV2ZW50LmNsaWVudFk7XHJcbn0pO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBldmVudCA9PiB7XHJcblx0aWYgKGVuYWJsZVBhbikge1xyXG5cdFx0dmlldy5wYW4oTWF0aC5yb3VuZChldmVudC5jbGllbnRYIC0gbW91c2VYKSwgTWF0aC5yb3VuZChldmVudC5jbGllbnRZIC0gbW91c2VZKSk7XHJcblx0XHRtb3VzZVggPSBldmVudC5jbGllbnRYO1xyXG5cdFx0bW91c2VZID0gZXZlbnQuY2xpZW50WTtcclxuXHR9XHJcbn0pO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgKCkgPT4gZW5hYmxlUGFuID0gZmFsc2UpO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxlYXZlJywgKCkgPT4gZW5hYmxlUGFuID0gZmFsc2UpO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmNhbmNlbCcsICgpID0+IGVuYWJsZVBhbiA9IGZhbHNlKTtcclxuXHJcbmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIGV2ZW50ID0+IHtcclxuXHR2aWV3Lnpvb20oZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSwgMSArIGV2ZW50LmRlbHRhWSAqIFdIRUVMX1NFTlNJVElWSVRZLCBXSEVFTF9SRURSQVdfREVMQVkpO1x0XHJcbn0pO1xyXG4vLyBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignZ2VzdHVyZWNoYW5nZScsIGV2ZW50ID0+IHtcclxuLy8gXHR2aWV3Lnpvb20oZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSwgZXZlbnQuc2NhbGUsIEdFU1RVUkVfU0NBTEVfREVMQVkpO1xyXG4vLyB9KTtcclxuLy8gY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2dlc3R1cmVlbmQnLCBldmVudCA9PiB7XHJcbi8vIFx0dmlldy56b29tKGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFksIGV2ZW50LnNjYWxlLCBHRVNUVVJFX1NDQUxFX0RFTEFZKTtcclxuLy8gfSk7XHJcblxyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZXZlbnQgPT4ge1xyXG5cdGRpc3BsYXlDb29yZGluYXRlcyhcclxuXHRcdHZpZXcudmlld3BvcnQueCArIGV2ZW50LmNsaWVudFggLyBjYW52YXMud2lkdGggKiB2aWV3LnZpZXdwb3J0LndpZHRoLFxyXG5cdFx0dmlldy52aWV3cG9ydC55ICsgZXZlbnQuY2xpZW50WSAvIGNhbnZhcy5oZWlnaHQgKiB2aWV3LnZpZXdwb3J0LmhlaWdodCk7XHJcbn0pO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcclxuXHRkaXNwbGF5Q29vcmRpbmF0ZXMoXHJcblx0XHR2aWV3LnZpZXdwb3J0LnggKyB2aWV3LnZpZXdwb3J0LndpZHRoKi41LFxyXG5cdFx0dmlldy52aWV3cG9ydC55ICsgdmlldy52aWV3cG9ydC5oZWlnaHQqLjUpO1xyXG59KTtcclxuXHJcbnZpZXcucmVzaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG5cclxuZGlzcGxheUNvb3JkaW5hdGVzKFxyXG5cdHZpZXcudmlld3BvcnQueCArIHZpZXcudmlld3BvcnQud2lkdGgqLjUsXHJcblx0dmlldy52aWV3cG9ydC55ICsgdmlldy52aWV3cG9ydC5oZWlnaHQqLjUpO1xyXG5cclxuZXhwb3J0IHsgdmlldyB9O1xyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgdmlldyB9IGZyb20gXCIuL2NhbnZhc1wiO1xyXG5cclxuLy8gQ29uc3RhbnRzXHJcblxyXG5jb25zdCBSRURSQVdfREVMQVkgPSA2MDA7XHJcblxyXG4vLyBHbG9iYWwgdmFyaWFibGVzXHJcblxyXG5sZXQgbGltaXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGltaXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50LFxyXG5cdHJlZHJhd1RpbWVyID0gMCxcclxuXHRkcmF3bkxpbWl0ID0gTnVtYmVyKGxpbWl0LnZhbHVlKTtcclxuXHJcbi8vIEZyZWUgZnVuY3Rpb25zXHJcblxyXG4vKiogUmVkcmF3IHRoZSBwaWN0dXJlIG9uIHRoZSAnbWFpbkNhbnZhcycgYWZ0ZXIgYSBzZXQgZGVsYXkuIENhbmNlbHMgYW55IHBlbmRpbmcgcmVkcmF3cy5cclxuICogQHBhcmFtIHtudW1iZXJ9IGxpbWl0IFRoZSBsaW1pdCB0byB1c2Ugd2hlbiByZWRyYXdpbmcuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWxheSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSByZWRyYXdpbmcuXHJcbiAqL1xyXG5mdW5jdGlvbiByZWRyYXdBZnRlckRlbGF5KGxpbWl0OiBudW1iZXIsIGRlbGF5OiBudW1iZXIpOiB2b2lkIHtcclxuXHRjbGVhclRpbWVvdXQocmVkcmF3VGltZXIpO1xyXG5cdHJlZHJhd1RpbWVyID0gd2luZG93LnNldFRpbWVvdXQoXHJcblx0XHQoKSA9PiB7XHJcblx0XHRcdGlmIChsaW1pdCAhPT0gZHJhd25MaW1pdCkge1xyXG5cdFx0XHRcdHZpZXcudXBkYXRlKGxpbWl0KTtcclxuXHRcdFx0XHRkcmF3bkxpbWl0ID0gbGltaXQ7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRkZWxheSk7XHJcbn1cclxuXHJcbi8qKiBSZWRyYXcgdGhlIHBpY3R1cmUgaW1tZWRpYXRlbHkgYW5kIGNhbmNlbCBhbnkgcGVuZGluZyByZWRyYXdzLlxyXG4gKiBAcGFyYW0ge251bWJlcn0gbGltaXQgVGhlIGxpbWl0IHRvIHVzZSB3aGVuIHJlZHJhd2luZy5cclxuICovXHJcbmZ1bmN0aW9uIHJlZHJhd0ltbWVkaWF0ZWx5KGxpbWl0OiBudW1iZXIpOiB2b2lkIHtcclxuXHRjbGVhclRpbWVvdXQocmVkcmF3VGltZXIpO1xyXG5cdGlmIChsaW1pdCAhPT0gZHJhd25MaW1pdCkge1xyXG5cdFx0dmlldy51cGRhdGUobGltaXQpO1xyXG5cdFx0ZHJhd25MaW1pdCA9IGxpbWl0O1xyXG5cdH1cclxufVxyXG5cclxuLy8gUmVnaXN0ZXIgZXZlbnQgbGlzdGVuZXJzXHJcblxyXG5saW1pdC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuXHRsZXQgdmFsdWUgPSBOdW1iZXIobGltaXQudmFsdWUpLFxyXG5cdFx0bWluID0gTnVtYmVyKGxpbWl0Lm1pbiksXHJcblx0XHRtYXggPSBOdW1iZXIobGltaXQubWF4KTtcclxuXHJcblx0aWYgKHZhbHVlIDwgbWluKSB7XHJcblx0XHR2YWx1ZSA9IG1pbjtcclxuXHR9IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7XHJcblx0XHR2YWx1ZSA9IG1heDtcclxuXHR9XHJcblxyXG5cdGlmICh2YWx1ZSA+PSBtaW4gJiYgdmFsdWUgPD0gbWF4KSB7XHJcblx0XHRyZWRyYXdBZnRlckRlbGF5KHZhbHVlLCBSRURSQVdfREVMQVkpO1xyXG5cdH1cclxufSk7XHJcbmxpbWl0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuXHRsZXQgdmFsdWUgPSAwLFxyXG5cdG1pbiA9IE51bWJlcihsaW1pdC5taW4pLFxyXG5cdG1heCA9IE51bWJlcihsaW1pdC5tYXgpO1xyXG5cdFxyXG5cdC8vIFZhbGlkYXRlIGlucHV0XHJcblx0aWYgKGxpbWl0LnZhbHVlID09PSAnJykge1xyXG5cdFx0bGltaXQudmFsdWUgPSAnMzAnO1xyXG5cdH1cclxuXHRcclxuXHR2YWx1ZSA9IE51bWJlcihsaW1pdC52YWx1ZSk7XHJcblxyXG5cdGlmICh2YWx1ZSA8IG1pbikge1xyXG5cdFx0bGltaXQudmFsdWUgPSBsaW1pdC5taW47XHJcblx0fSBlbHNlIGlmICh2YWx1ZSA+IG1heCkge1xyXG5cdFx0bGltaXQudmFsdWUgPSBsaW1pdC5tYXg7XHJcblx0fVxyXG5cclxuXHRyZWRyYXdJbW1lZGlhdGVseShOdW1iZXIobGltaXQudmFsdWUpKTtcclxufSk7XHJcbiIsImltcG9ydCB7IHZpZXcgfSBmcm9tIFwiLi9jYW52YXNcIjtcclxuXHJcbi8vIENvbnN0YW50c1xyXG5cclxuY29uc3QgTUVOVV9XSURUSCA9IDI0MDtcclxuY29uc3QgVE9HR0xFX0JVVFRPTl9NQVJHSU4gPSAyMDtcclxuXHJcbi8vIEdsb2JhbCB2YXJpYWJsZXNcclxuXHJcbmxldCBsaW1pdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW1pdCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQsXHJcblx0c2lkZU1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZS1tZW51JykhLFxyXG5cdHRvZ2dsZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtbWVudScpISxcclxuXHRhcnJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGUtbWVudS1hcnJvdycpITtcclxuXHJcbi8vIEZyZWUgZnVuY3Rpb25zXHJcblxyXG4vKiogT3BlbiB0aGUgc2lkZSBtZW51IG9mIHRoZSBkb2N1bWVudC4gKi9cclxuZnVuY3Rpb24gb3BlblNpZGVNZW51KCkge1xyXG5cdHZhciBzaWRlTWVudVdpZHRoID0gMDtcclxuXHJcblx0c2lkZU1lbnUuc3R5bGUud2lkdGggPSBgJHtNRU5VX1dJRFRIfXB0YDtcclxuXHRzaWRlTWVudVdpZHRoID0gc2lkZU1lbnUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XHJcblx0dG9nZ2xlQnV0dG9uLnN0eWxlLm1hcmdpblJpZ2h0ID0gYCR7TUVOVV9XSURUSCArIFRPR0dMRV9CVVRUT05fTUFSR0lOfXB0YDtcclxuXHRhcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdsZWZ0Jyk7XHJcblx0YXJyb3cuY2xhc3NMaXN0LmFkZCgncmlnaHQnKTtcclxufVxyXG5cclxuLyoqIENsb3NlIHRoZSBzaWRlIG1lbnUgb2YgdGhlIGRvY3VtZW50LiAqL1xyXG5mdW5jdGlvbiBjbG9zZVNpZGVNZW51KCkge1xyXG5cdHNpZGVNZW51LnN0eWxlLndpZHRoID0gJzAnO1xyXG5cdHRvZ2dsZUJ1dHRvbi5zdHlsZS5tYXJnaW5SaWdodCA9IGAke1RPR0dMRV9CVVRUT05fTUFSR0lOfXB0YDtcclxuXHRhcnJvdy5jbGFzc0xpc3QucmVtb3ZlKCdyaWdodCcpO1xyXG5cdGFycm93LmNsYXNzTGlzdC5hZGQoJ2xlZnQnKTtcclxufVxyXG5cclxuLyoqIE9wZW4gdGhlIHNpZGUgbWVudSBvZiB0aGUgZG9jdW1lbnQgaWYgaXQncyBjbG9zZWQgb3IgY2xvc2UgaXQgaWYgaXQncyBvcGVuLiAqL1xyXG5mdW5jdGlvbiB0b2dnbGVTaWRlTWVudSgpIHtcclxuXHRpZiAoc2lkZU1lbnUuc3R5bGUud2lkdGggPT09IGAke01FTlVfV0lEVEh9cHRgKSB7XHJcblx0XHRjbG9zZVNpZGVNZW51KCk7XHJcblx0fSBlbHNlIHtcclxuXHRcdG9wZW5TaWRlTWVudSgpO1xyXG5cdH1cclxufVxyXG5cclxuLy8gUmVnaXN0ZXIgZXZlbnRzXHJcblxyXG50b2dnbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVTaWRlTWVudSk7XHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWRyYXcnKSEub25jbGljayA9IHZpZXcudXBkYXRlLmJpbmQodmlldywgTnVtYmVyKGxpbWl0LnZhbHVlKSwgdW5kZWZpbmVkKTtcclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0JykhLm9uY2xpY2sgPSB2aWV3LnJlc2V0LmJpbmQodmlldywgTnVtYmVyKGxpbWl0LnZhbHVlKSk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=