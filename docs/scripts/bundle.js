(()=>{"use strict";var t={447:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ProceduralImageView=void 0;const i=new Uint8ClampedArray;function h(t,e,i,h){let s=t+e,n=i+h;return t>=i&&t<=n&&s>=i&&s<=n}e.ProceduralImageView=class{constructor(t,e,i,h=64,s=64){this.updateInProgress=!1,this.updateQueued=!1,this.prefill=!1,this.offsetX=0,this.offsetY=0,this.cleanX=0,this.cleanY=0,this.cleanW=0,this.cleanH=0,this.config={limit:30,escapeRadius:4},this.canvas=t,this.context=t.getContext("2d"),this.chunkWidth=h,this.chunkHeight=s,this.viewport=e||this.defaultViewport,i=i||window.navigator.hardwareConcurrency,this.freeWorkers=[],this.work=[];for(var n=0;n<i;++n){let t=new Worker("./scripts/draw_worker.js"),e=new Uint8ClampedArray(h*s*4);((t,e)=>{t.onmessage=i=>{let h=new Uint8ClampedArray(i.data.pixels);i.data.zoomW===this.viewport.width&&i.data.zoomH===this.viewport.height&&e.context.putImageData(new ImageData(h,i.data.width,i.data.height),i.data.pixelX+e.offsetX-i.data.offsetX,i.data.pixelY+e.offsetY-i.data.offsetY);let s=e.work.pop();null!=s?(s.pixels=h.buffer,t.postMessage(s,[s.pixels])):(e.freeWorkers.push([t,h]),e.updateInProgress=!1,e.updateQueued?e.update():(e.cleanX=0,e.cleanY=0,e.cleanW=e.canvas.width,e.cleanH=e.canvas.height))}})(t,this),this.freeWorkers.push([t,e])}}get defaultViewport(){if(this.canvas.width>=this.canvas.height){let t=this.canvas.width/this.canvas.height;return new DOMRect(-t,-1,2*t,2)}{let t=this.canvas.height/this.canvas.height;return new DOMRect(-1,-t,2,2*t)}}get limit(){return this.config.limit}set limit(t){this.config.limit=t}get escapeRadius(){return this.config.escapeRadius}set escapeRadius(t){this.config.escapeRadius=t}get fillStyle(){return this.prefill?this.context.fillStyle:null}set fillStyle(t){null!=t?(this.prefill=!0,this.context.fillStyle=t):this.prefill=!1}update(){this.cleanW=0,this.cleanH=0,this.offsetX=0,this.offsetY=0,this.updateDirty()}updateDirty(){this.clearWork(),this.updateQueued=!1,this.updateInProgress=!0;let t=Math.ceil(this.canvas.width/this.chunkWidth),e=Math.ceil(this.canvas.height/this.chunkHeight);const s=this.chunkWidth/this.canvas.width*this.viewport.width,n=this.chunkHeight/this.canvas.height*this.viewport.height;for(var a=0;a<e;++a){const e=a*this.chunkHeight,o=this.viewport.y+a*this.chunkHeight/this.canvas.height*this.viewport.height,r=h(e,this.chunkHeight,this.cleanY,this.cleanH);for(var c=0;c<t;++c){const t=c*this.chunkWidth;if(r&&h(t,this.chunkWidth,this.cleanX,this.cleanW))continue;const a=this.viewport.x+c*this.chunkWidth/this.canvas.width*this.viewport.width;this.prefill&&this.context.fillRect(t,e,this.chunkWidth,this.chunkHeight),this.queueWork({pixels:i,width:this.chunkWidth,height:this.chunkHeight,rect:new DOMRect(a,o,s,n),config:this.config,pixelX:t,pixelY:e,offsetX:this.offsetX,offsetY:this.offsetY,zoomW:this.viewport.width,zoomH:this.viewport.height})}}this.work.reverse()}queueUpdate(){this.updateInProgress?this.updateQueued=!0:this.update()}pan(t,e){let i=t>=0?t:this.canvas.width+t,h=e>=0?e:this.canvas.height+e,s=[];if(this.viewport.x-=t/this.canvas.width*this.viewport.width,this.viewport.y-=e/this.canvas.height*this.viewport.height,s=[new DOMRect(0,0,i,h),new DOMRect(i,0,this.canvas.width-i,h),new DOMRect(0,h,i,this.canvas.height-h),new DOMRect(i,h,this.canvas.width-i,this.canvas.height-h)],t<0&&e<0){let i=this.context.getImageData(-t,-e,s[0].width,s[0].height);this.context.putImageData(i,0,0)}else if(t>=0&&e<0){let i=this.context.getImageData(0,-e,s[1].width,s[1].height);this.context.putImageData(i,t,0)}else if(t<0&&e>=0){let i=this.context.getImageData(-t,0,s[2].width,s[2].height);this.context.putImageData(i,0,e)}else if(t>=0&&e>=0){let i=this.context.getImageData(0,0,s[3].width,s[3].height);this.context.putImageData(i,t,e)}this.offsetX+=t,this.offsetY+=e,this.cleanX+=t,this.cleanY+=e,this.clampCleanRect(),this.updateDirty()}zoom(t,e,i){let h=t/this.canvas.width,s=e/this.canvas.height,n=this.viewport.x+this.viewport.width*h,a=this.viewport.y+this.viewport.height*s;if(this.viewport.width*=i,this.viewport.height*=i,this.viewport.x=n-this.viewport.width*h,this.viewport.y=a-this.viewport.height*s,i>1){let t=1/i;this.context.drawImage(this.canvas,this.canvas.width*h-this.canvas.width*h*t,this.canvas.height*s-this.canvas.height*s*t,this.canvas.width*t,this.canvas.height*t)}else this.context.drawImage(this.canvas,this.canvas.width*h-this.canvas.width*h*i,this.canvas.height*s-this.canvas.height*s*i,this.canvas.width*i,this.canvas.height*i,0,0,this.canvas.width,this.canvas.height);this.update()}resize(t,e){let i=this.context.fillStyle;this.viewport.width*=t/this.canvas.width,this.viewport.height*=e/this.canvas.height,this.canvas.width=t,this.canvas.height=e,this.context.fillStyle=i,this.update()}clearWork(){this.work.length=0}queueWork(t){let e=this.freeWorkers.pop();null!=e?(t.pixels=e[1].buffer,e[0].postMessage(t,[t.pixels])):this.work.push(t)}clampCleanRect(){this.cleanX<0&&(this.cleanW+=this.cleanX,this.cleanX=0),this.cleanY<0&&(this.cleanH+=this.cleanY,this.cleanY=0),this.cleanW+this.cleanX>this.canvas.width&&(this.cleanW=this.canvas.width-this.cleanX),this.cleanH+this.cleanY>this.canvas.height&&(this.cleanH=this.canvas.height-this.cleanY),this.cleanW<0&&(this.cleanW=0),this.cleanH<0&&(this.cleanH=0)}}},235:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.view=void 0;const h=i(447);let s=document.getElementById("coord-x"),n=document.getElementById("coord-y"),a=0,c=0,o=!1;function r(t,e){s.textContent=`X: ${t.toExponential(3)}`,n.textContent=`Y: ${e.toExponential(3)}`}let l=document.getElementById("canvas");l.width=window.innerWidth,l.height=window.innerHeight;let d=new h.ProceduralImageView(l);e.view=d,window.addEventListener("resize",(()=>d.resize(window.innerWidth,window.innerHeight))),l.addEventListener("pointerdown",(t=>{o=!0,a=t.clientX,c=t.clientY})),l.addEventListener("pointermove",(t=>{o&&(d.pan(Math.round(t.clientX-a),Math.round(t.clientY-c)),a=t.clientX,c=t.clientY)})),l.addEventListener("pointerup",(()=>o=!1)),l.addEventListener("pointerleave",(()=>o=!1)),l.addEventListener("pointercancel",(()=>o=!1)),l.addEventListener("wheel",(t=>{d.zoom(t.clientX,t.clientY,1+.001*t.deltaY)})),l.addEventListener("mousemove",(t=>{r(d.viewport.x+t.clientX/l.width*d.viewport.width,d.viewport.y+t.clientY/l.height*d.viewport.height)})),l.addEventListener("mouseleave",(()=>{r(d.viewport.x+.5*d.viewport.width,d.viewport.y+.5*d.viewport.height)})),d.resize(window.innerWidth,window.innerHeight),r(d.viewport.x+.5*d.viewport.width,d.viewport.y+.5*d.viewport.height)},627:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.resetConfigs=void 0;const h=i(235);var s=[];function n(t,e){let i=Number(t.min),h=Number(t.max),n=Number(t.value);s.push(t);let a=()=>{let s=Number(t.value);""===t.value&&(s=n,t.value=s.toString()),s<i?(s=i,t.value=s.toString()):s>h&&(s=h,t.value=s.toString()),s>=i&&s<=h&&e(s)};t.addEventListener("input",a),t.addEventListener("change",a)}e.resetConfigs=function(){s.forEach((t=>{t.value="";let e=document.createEvent("Event");e.initEvent("input"),t.dispatchEvent(e)}))},n(document.getElementById("limit"),(t=>{let e=h.view.limit!=t;h.view.limit=t,e&&h.view.queueUpdate()})),n(document.getElementById("escaper"),(t=>{let e=h.view.escapeRadius!=t;h.view.escapeRadius=t,e&&h.view.queueUpdate()}))}},e={};function i(h){var s=e[h];if(void 0!==s)return s.exports;var n=e[h]={exports:{}};return t[h](n,n.exports,i),n.exports}(()=>{const t=i(235),e=i(627);let h=document.getElementById("side-menu"),s=document.getElementById("toggle-menu"),n=document.getElementById("toggle-menu-arrow");s.addEventListener("click",(function(){"240pt"===h.style.width?(h.style.width="0",s.style.marginRight="20pt",n.classList.remove("right"),n.classList.add("left")):(h.style.width="240pt",h.getBoundingClientRect().width,s.style.marginRight="260pt",n.classList.remove("left"),n.classList.add("right"))})),document.getElementById("redraw").onclick=()=>t.view.update(),document.getElementById("reset").onclick=()=>{t.view.viewport=t.view.defaultViewport,e.resetConfigs(),t.view.update()}})()})();